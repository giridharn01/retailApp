"use strict";(self.webpackChunkclient=self.webpackChunkclient||[]).push([[260],{260:(e,s,t)=>{t.r(s),t.d(s,{default:()=>c});var r=t(555),a=t(43),l=t(536),i=t(579);const n={pending:"bg-yellow-100 text-yellow-800","in-progress":"bg-blue-100 text-blue-800",completed:"bg-green-100 text-green-800",cancelled:"bg-red-100 text-red-800",default:"bg-gray-100 text-gray-800"},c=a.memo(()=>{const[e,s]=(0,a.useState)(!1),[t,c]=(0,a.useState)(null),[o,d]=(0,a.useState)(""),[u,x]=(0,a.useState)([]),[m,h]=(0,a.useState)([]),[b,p]=(0,a.useState)([]),[f,g]=(0,a.useState)(!1),[v,j]=(0,a.useState)(null),y=(0,a.useRef)([]),[N,w]=(0,a.useState)({serviceType:"",preferredDate:"",preferredTime:"",contactNumber:"",description:""}),S=(0,a.useCallback)(async()=>{try{const e=await(0,l.A)("/service-types");x(e.data||[])}catch(e){c("Failed to load service data")}},[]),k=(0,a.useCallback)(async function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];try{e||s(!0);const t=(await(0,l.A)("/service-requests/user")).data||[],r=y.current;if(e&&r.length>0){const e=[];t.forEach(s=>{const t=r.find(e=>e._id===s._id);t&&t.status!==s.status&&e.push({serviceType:s.serviceType,oldStatus:t.status,newStatus:s.status})}),e.length>0&&(p(e),g(!0),setTimeout(()=>g(!1),5e3))}h(t),y.current=t,e&&j(new Date)}catch(t){c("Failed to fetch your service requests")}finally{e||s(!1)}},[]);(0,a.useEffect)(()=>{S(),k()},[S,k]),(0,a.useEffect)(()=>{console.log("Setting up polling for real-time updates");const e=setInterval(()=>{k(!0)},1e4),s=()=>{k(!0)};return window.addEventListener("focus",s),()=>{clearInterval(e),window.removeEventListener("focus",s)}},[k]);const T=(0,a.useCallback)(e=>{w((0,r.A)((0,r.A)({},N),{},{[e.target.name]:e.target.value}))},[N]),q=e=>{if(e.statusHistory&&e.statusHistory.length>0){const s=e.statusHistory[e.statusHistory.length-1],t=new Date(s.timestamp);return new Date-t<3e5}return!1},C=(0,a.useCallback)(async e=>{e.preventDefault(),s(!0),c(null),d("");try{await(0,l.A)("/service-requests","POST",N),d("Service request submitted successfully!"),w({serviceType:"",preferredDate:"",preferredTime:"",contactNumber:"",description:""}),k()}catch(t){c(t.message)}finally{s(!1)}},[N,k]);return(0,i.jsx)("div",{className:"min-h-screen bg-gray-50 py-8",children:(0,i.jsxs)("div",{className:"max-w-6xl mx-auto px-4 py-8",children:[f&&(0,i.jsxs)("div",{className:"fixed top-4 right-4 z-50 bg-blue-500 text-white px-6 py-3 rounded-lg shadow-lg flex items-center space-x-3 animate-pulse",children:[(0,i.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,i.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),(0,i.jsxs)("div",{children:[(0,i.jsx)("span",{className:"font-medium",children:"Service request status updated!"}),(0,i.jsxs)("div",{className:"text-sm opacity-90",children:[b.map((e,s)=>(0,i.jsxs)("div",{children:[e.serviceType,": ",e.oldStatus," \u2192 ",e.newStatus]},s)),(0,i.jsx)("div",{className:"text-xs mt-1 opacity-75",children:"Auto-refreshed"})]})]}),(0,i.jsx)("button",{onClick:()=>g(!1),className:"ml-2 text-white hover:text-gray-200",children:(0,i.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,i.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,i.jsxs)("div",{className:"mb-10 text-center",children:[(0,i.jsx)("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"Request a Service"}),(0,i.jsx)("p",{className:"text-gray-600 mb-2",children:"Fill out the form to request a new service. You can also view your previous requests below."}),(0,i.jsx)("div",{className:"w-16 h-1 bg-blue-600 rounded mx-auto"})]}),(0,i.jsxs)("div",{className:"flex flex-col lg:flex-row gap-8",children:[(0,i.jsxs)("div",{className:"flex-1 bg-white rounded-lg shadow-md p-6",children:[(0,i.jsx)("h2",{className:"text-xl font-semibold text-gray-800 mb-4",children:"New Service Request"}),t&&(0,i.jsx)("div",{className:"mb-4 rounded-md bg-red-50 p-3 text-red-700 text-sm",children:t}),o&&(0,i.jsx)("div",{className:"mb-4 rounded-md bg-green-50 p-3 text-green-700 text-sm",children:o}),(0,i.jsxs)("form",{onSubmit:C,className:"space-y-6 w-full max-w-xl",children:[(0,i.jsxs)("div",{className:"grid grid-cols-1 gap-6 sm:grid-cols-2",children:[(0,i.jsxs)("div",{children:[(0,i.jsxs)("label",{htmlFor:"serviceType",className:"block text-sm font-semibold text-gray-700 mb-2",children:["Service Type ",(0,i.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,i.jsxs)("select",{id:"serviceType",name:"serviceType",value:N.serviceType,onChange:T,className:"block w-full bg-blue-50 border border-blue-200 rounded-lg px-4 py-3 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition shadow-sm text-base font-medium",required:!0,children:[(0,i.jsx)("option",{value:"",disabled:!0,className:"text-gray-400",children:"Select Service Type"}),u.map(e=>(0,i.jsxs)("option",{value:e.name,className:"py-3 px-4 text-blue-900 bg-blue-50 hover:bg-blue-100 hover:text-blue-700 border-b border-blue-100 last:border-b-0",children:[e.name," \xa0 ",(0,i.jsxs)("span",{className:"text-gray-500",children:["\u20b9",e.basePrice]})]},e._id))]})]}),(0,i.jsxs)("div",{children:[(0,i.jsxs)("label",{htmlFor:"contactNumber",className:"block text-sm font-semibold text-gray-700 mb-2",children:["Contact Number ",(0,i.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,i.jsx)("input",{type:"tel",id:"contactNumber",name:"contactNumber",value:N.contactNumber,onChange:T,className:"block w-full bg-white border border-gray-300 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition shadow-sm text-base",placeholder:"Your phone number",required:!0})]}),(0,i.jsxs)("div",{children:[(0,i.jsxs)("label",{htmlFor:"preferredDate",className:"block text-sm font-semibold text-gray-700 mb-2",children:["Preferred Date ",(0,i.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,i.jsx)("input",{type:"date",id:"preferredDate",name:"preferredDate",value:N.preferredDate,onChange:T,className:"block w-full bg-white border border-gray-300 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition shadow-sm text-base",min:(new Date).toISOString().split("T")[0],required:!0})]}),(0,i.jsxs)("div",{children:[(0,i.jsxs)("label",{htmlFor:"preferredTime",className:"block text-sm font-semibold text-gray-700 mb-2",children:["Preferred Time ",(0,i.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,i.jsxs)("select",{id:"preferredTime",name:"preferredTime",value:N.preferredTime,onChange:T,className:"block w-full bg-white border border-gray-300 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition shadow-sm text-base",required:!0,children:[(0,i.jsx)("option",{value:"",disabled:!0,children:"Select Time"}),(0,i.jsx)("option",{value:"09:00",children:"9:00 AM"}),(0,i.jsx)("option",{value:"10:00",children:"10:00 AM"}),(0,i.jsx)("option",{value:"11:00",children:"11:00 AM"}),(0,i.jsx)("option",{value:"12:00",children:"12:00 PM"}),(0,i.jsx)("option",{value:"13:00",children:"1:00 PM"}),(0,i.jsx)("option",{value:"14:00",children:"2:00 PM"}),(0,i.jsx)("option",{value:"15:00",children:"3:00 PM"}),(0,i.jsx)("option",{value:"16:00",children:"4:00 PM"}),(0,i.jsx)("option",{value:"17:00",children:"5:00 PM"})]})]})]}),(0,i.jsxs)("div",{children:[(0,i.jsxs)("label",{htmlFor:"description",className:"block text-sm font-semibold text-gray-700 mb-2",children:["Service Description ",(0,i.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,i.jsx)("textarea",{id:"description",name:"description",value:N.description,onChange:T,rows:4,className:"block w-full bg-white border border-gray-300 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition shadow-sm text-base resize-none",placeholder:"Please describe the issue or service you need...",required:!0})]}),(0,i.jsx)("div",{className:"flex justify-end",children:(0,i.jsx)("button",{type:"submit",disabled:e,className:"inline-flex justify-center py-2 px-6 border border-transparent shadow-sm text-base font-semibold rounded-lg text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed transition",children:e?"Submitting...":"Submit Request"})})]})]}),(0,i.jsxs)("div",{className:"flex-1 bg-white rounded-lg shadow-md p-6 mt-8 lg:mt-0",children:[(0,i.jsxs)("div",{className:"flex flex-col sm:flex-row sm:justify-between sm:items-center mb-6 gap-4",children:[(0,i.jsx)("h2",{className:"text-xl font-semibold text-gray-800",children:"Your Service Requests"}),v&&(0,i.jsxs)("div",{className:"text-xs text-gray-500 flex items-center",children:[(0,i.jsx)("span",{className:"w-2 h-2 bg-green-400 rounded-full mr-2 animate-pulse"}),"Last updated: ",v.toLocaleTimeString()]})]}),0===m.length?(0,i.jsxs)("div",{className:"text-center py-12",children:[(0,i.jsx)("div",{className:"text-6xl mb-4",children:"\ud83d\udee0\ufe0f"}),(0,i.jsx)("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"No service requests found"}),(0,i.jsx)("p",{className:"text-gray-600",children:"You haven't submitted any service requests yet."})]}):(0,i.jsx)("div",{className:"space-y-6",children:m.map(e=>(0,i.jsxs)("div",{className:"bg-white rounded-lg shadow-md overflow-hidden ".concat(q(e)?"ring-2 ring-blue-500 ring-opacity-50":""),children:[(0,i.jsxs)("div",{className:"p-4 flex flex-col sm:flex-row sm:justify-between sm:items-center gap-2",children:[(0,i.jsxs)("div",{children:[(0,i.jsxs)("div",{className:"flex items-center space-x-2 mb-1",children:[(0,i.jsx)("div",{className:"font-medium text-blue-700",children:e.serviceType}),q(e)&&(0,i.jsxs)("span",{className:"inline-flex items-center px-2 py-1 text-xs font-medium bg-blue-100 text-blue-800 rounded-full",children:[(0,i.jsx)("svg",{className:"w-3 h-3 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,i.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})}),"Updated"]})]}),(0,i.jsxs)("div",{className:"text-sm text-gray-500",children:["Preferred: ",e.preferredDate?new Date(e.preferredDate).toLocaleDateString():"-"," ",e.preferredTime||""]}),(0,i.jsxs)("div",{className:"text-sm text-gray-500",children:["Contact: ",e.contactNumber]})]}),(0,i.jsx)("span",{className:"px-2 py-1 rounded-full text-xs font-medium w-max ".concat(n[e.status]||n.default),children:e.status.charAt(0).toUpperCase()+e.status.slice(1)})]}),(0,i.jsx)("div",{className:"px-4 pb-4 text-gray-700 text-sm",children:e.description}),e.statusHistory&&e.statusHistory.length>1&&(0,i.jsxs)("div",{className:"px-4 pb-4 text-xs text-gray-500",children:[(0,i.jsx)("span",{children:"Status history: "}),e.statusHistory.map((s,t)=>(0,i.jsxs)("span",{children:[s.status,t<e.statusHistory.length-1?", ":""]},t))]})]},e._id))})]})]})]})})})}}]);
//# sourceMappingURL=260.caafc4cf.chunk.js.map