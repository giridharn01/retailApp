"use strict";(self.webpackChunkclient=self.webpackChunkclient||[]).push([[810],{810:(e,s,t)=>{t.r(s),t.d(s,{default:()=>d});var r=t(555),n=t(43),a=t(536),l=t(579);const i=[{value:"pending",label:"Pending"},{value:"in-progress",label:"In Progress"},{value:"ready-for-pickup",label:"Ready for Pickup"},{value:"cancelled",label:"Cancelled"}],d=()=>{var e,s,t,d;const[c,o]=(0,n.useState)([]),[m,x]=(0,n.useState)(!0),[u,h]=(0,n.useState)(null),[p,g]=(0,n.useState)("all"),[j,v]=(0,n.useState)({}),[f,b]=(0,n.useState)(!1),[N,y]=(0,n.useState)({trackingNumber:"",carrier:"",estimatedDelivery:""});(0,n.useEffect)(()=>{w(),k()},[]),(0,n.useEffect)(()=>{console.log("AdminOrderManagementPage setting up polling for real-time updates");const e=setInterval(()=>{w(!0),k()},2e4),s=()=>{w(!0),k()};return window.addEventListener("focus",s),()=>{clearInterval(e),window.removeEventListener("focus",s)}},[]);const w=async function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];try{e||x(!0);const s=(await(0,a.A)("/orders")).data;o(s)}catch(s){console.error("Error fetching orders:",s)}finally{e||x(!1)}},k=async()=>{try{const e=await(0,a.A)("/orders/stats");v(e.data)}catch(e){console.error("Error fetching stats:",e)}},[A,C]=(0,n.useState)({}),[_,L]=(0,n.useState)({}),S=e=>{switch(e){case"ready-for-pickup":return"bg-green-100 text-green-800";case"in-progress":return"bg-blue-100 text-blue-800";case"cancelled":return"bg-red-100 text-red-800";default:return"bg-yellow-100 text-yellow-800"}},D=e=>new Date(e).toLocaleDateString("en-IN",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),E=e=>new Date-new Date(e)<3e5,P=c.filter(e=>"all"===p||e.status===p),[T,I]=(0,n.useState)(null),O=(0,n.useRef)({});return(0,n.useEffect)(()=>{function e(e){null!==T&&O.current[T]&&!O.current[T].contains(e.target)&&I(null)}return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[T]),m?(0,l.jsx)("div",{className:"flex justify-center items-center min-h-[60vh]",children:(0,l.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):(0,l.jsxs)("div",{className:"max-w-7xl mx-auto px-4 py-8",children:[(0,l.jsxs)("div",{className:"flex justify-between items-center mb-8",children:[(0,l.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:"Order Management"}),(0,l.jsx)("div",{className:"flex items-center space-x-4",children:(0,l.jsx)("div",{className:"flex items-center space-x-2",children:(0,l.jsxs)("span",{className:"text-sm text-gray-600",children:["Last updated: ",(M=new Date,new Date(M).toLocaleTimeString("en-IN",{hour:"2-digit",minute:"2-digit",second:"2-digit"}))]})})})]}),(0,l.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6 mb-8",children:[(0,l.jsxs)("div",{className:"bg-white rounded-lg shadow-md p-6",children:[(0,l.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Total Orders"}),(0,l.jsx)("p",{className:"text-3xl font-bold text-blue-600",children:j.totalOrders||0})]}),(0,l.jsxs)("div",{className:"bg-white rounded-lg shadow-md p-6",children:[(0,l.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Total Revenue"}),(0,l.jsxs)("p",{className:"text-3xl font-bold text-green-600",children:["\u20b9",j.totalRevenue||0]})]}),(0,l.jsxs)("div",{className:"bg-white rounded-lg shadow-md p-6",children:[(0,l.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Pending Orders"}),(0,l.jsx)("p",{className:"text-3xl font-bold text-yellow-600",children:(null===(e=j.statusBreakdown)||void 0===e||null===(s=e.find(e=>"pending"===e._id))||void 0===s?void 0:s.count)||0})]}),(0,l.jsxs)("div",{className:"bg-white rounded-lg shadow-md p-6",children:[(0,l.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Ready for Pickup"}),(0,l.jsx)("p",{className:"text-3xl font-bold text-green-600",children:(null===(t=j.statusBreakdown)||void 0===t||null===(d=t.find(e=>"ready-for-pickup"===e._id))||void 0===d?void 0:d.count)||0})]})]}),(0,l.jsx)("div",{className:"flex justify-between items-center mb-6",children:(0,l.jsx)("div",{className:"flex space-x-2",children:(0,l.jsxs)("select",{value:p,onChange:e=>g(e.target.value),className:"px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[(0,l.jsx)("option",{value:"all",children:"All Orders"}),(0,l.jsx)("option",{value:"pending",children:"Pending"}),(0,l.jsx)("option",{value:"in-progress",children:"In Progress"}),(0,l.jsx)("option",{value:"ready-for-pickup",children:"Ready for Pickup"}),(0,l.jsx)("option",{value:"cancelled",children:"Cancelled"})]})})}),(0,l.jsx)("div",{className:"space-y-6",children:P.map(e=>{var s,t,n,d,m,x,p,g,j,v;return(0,l.jsxs)("div",{className:"bg-white rounded-lg shadow-md ".concat(E(e.createdAt)?"ring-2 ring-green-500 ring-opacity-50":""),children:[(0,l.jsx)("div",{className:"p-6 border-b border-gray-200",children:(0,l.jsxs)("div",{className:"flex justify-between items-start",children:[(0,l.jsxs)("div",{children:[(0,l.jsxs)("div",{className:"flex items-center space-x-3 mb-2",children:[(0,l.jsxs)("h3",{className:"text-lg font-semibold text-gray-900",children:["Order #",e.orderNumber]}),E(e.createdAt)&&(0,l.jsxs)("span",{className:"inline-flex items-center px-2 py-1 text-xs font-medium bg-green-100 text-green-800 rounded-full",children:[(0,l.jsx)("svg",{className:"w-3 h-3 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,l.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})}),"New"]})]}),(0,l.jsxs)("p",{className:"text-sm text-gray-600",children:["Customer: ",null===(s=e.user)||void 0===s?void 0:s.name," (",null===(t=e.user)||void 0===t?void 0:t.email,")"]}),(0,l.jsxs)("p",{className:"text-sm text-gray-600",children:["Placed on ",D(e.createdAt)]}),(0,l.jsxs)("p",{className:"text-sm text-gray-600",children:["Total: \u20b9",e.totalAmount]})]}),(0,l.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,l.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,l.jsx)("label",{className:"text-sm font-medium text-gray-700",children:"Status:"}),(0,l.jsxs)("div",{className:"relative",ref:s=>O.current[e._id]=s,children:[(0,l.jsx)("button",{type:"button",disabled:A[e._id],className:"rounded-2xl px-4 py-1 text-sm font-medium flex items-center justify-center focus:outline-none border border-gray-300 transition-all min-w-[120px] ".concat(S(e.status)," ").concat(A[e._id]?"opacity-50 cursor-not-allowed":""),onClick:()=>I(T===e._id?null:e._id),children:A[e._id]?(0,l.jsx)("svg",{className:"animate-spin w-4 h-4 text-gray-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,l.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}):_[e._id]?(0,l.jsxs)("div",{className:"flex items-center",children:[(0,l.jsx)("svg",{className:"w-4 h-4 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,l.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),(0,l.jsx)("span",{className:"ml-1 text-xs text-green-600",children:"Updated"})]}):(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("span",{className:"w-full text-center",children:(null===(n=i.find(s=>s.value===e.status))||void 0===n?void 0:n.label)||e.status}),(0,l.jsx)("svg",{className:"ml-2 w-4 h-4 text-gray-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,l.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]})}),T===e._id&&!A[e._id]&&(0,l.jsx)("div",{className:"absolute left-0 mt-2 z-50 bg-white shadow-xl rounded-xl py-2 px-2 min-w-[400px] w-max border border-gray-200 max-h-60 overflow-y-auto",children:(0,l.jsx)("div",{className:"flex flex-row gap-2",children:i.map((s,t)=>{const n=e.status===s.value;return(0,l.jsxs)("div",{className:"cursor-pointer flex items-center justify-center rounded-full px-2 py-1 text-xs font-medium transition-all ".concat(S(s.value),"\n                                                                        ").concat(n?"ring-2 ring-blue-500 border border-blue-400 bg-opacity-90":"","\n                                                                        hover:ring-2 hover:ring-blue-300 hover:bg-opacity-80"),style:{minWidth:0},onClick:()=>{I(null),n||async function(e,s){let t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";try{C(s=>(0,r.A)((0,r.A)({},s),{},{[e]:!0})),o(t=>t.map(t=>t._id===e?(0,r.A)((0,r.A)({},t),{},{status:s}):t)),await(0,a.A)("/orders/".concat(e),"PUT",{status:s,note:t}),await new Promise(e=>setTimeout(e,500)),await w(),await k(),c.find(s=>s._id===e)&&(L(s=>(0,r.A)((0,r.A)({},s),{},{[e]:!0})),setTimeout(()=>{L(s=>(0,r.A)((0,r.A)({},s),{},{[e]:!1}))},2e3))}catch(n){console.error("Error updating order status:",n),alert("Error updating order status"),await w()}finally{C(s=>(0,r.A)((0,r.A)({},s),{},{[e]:!1}))}}(e._id,s.value)},children:[(0,l.jsx)("span",{className:"w-full text-center",children:s.label}),n&&(0,l.jsx)("svg",{className:"ml-1 w-3 h-3 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,l.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3,d:"M5 13l4 4L19 7"})})]},s.value)})})})]})]}),(0,l.jsxs)("button",{onClick:()=>h((null===u||void 0===u?void 0:u._id)===e._id?null:e),className:"inline-flex items-center px-3 py-2 text-sm font-medium text-blue-600 hover:text-blue-800 hover:bg-blue-50 rounded-md transition-colors",children:[(0,l.jsx)("span",{children:"Details"}),(0,l.jsx)("svg",{className:"ml-1 w-4 h-4 transition-transform ".concat((null===u||void 0===u?void 0:u._id)===e._id?"rotate-180":""),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,l.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]})]})]})}),(null===u||void 0===u?void 0:u._id)===e._id&&(0,l.jsx)("div",{className:"p-6 bg-gray-50",children:(0,l.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("h4",{className:"text-lg font-semibold mb-4",children:"Order Items"}),(0,l.jsx)("div",{className:"space-y-3",children:e.items.map((e,s)=>(0,l.jsxs)("div",{className:"flex items-center space-x-3 p-3 bg-white rounded-lg",children:[(0,l.jsx)("img",{src:e.product.image||"/default-product.jpg",alt:e.product.name,className:"w-12 h-12 object-cover rounded"}),(0,l.jsxs)("div",{className:"flex-1",children:[(0,l.jsx)("p",{className:"font-medium",children:e.product.name}),(0,l.jsxs)("p",{className:"text-sm text-gray-600",children:["Qty: ",e.quantity," \xd7 \u20b9",e.price]})]}),(0,l.jsxs)("p",{className:"font-semibold",children:["\u20b9",e.subtotal]})]},s))})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("h4",{className:"text-lg font-semibold mb-4",children:"Order Management"}),(0,l.jsxs)("div",{className:"bg-white p-4 rounded-lg",children:[(0,l.jsxs)("div",{className:"flex justify-between items-center mb-2",children:[(0,l.jsx)("h5",{className:"font-medium",children:"Tracking Information"}),(0,l.jsx)("button",{onClick:()=>b(!f),className:"inline-flex items-center px-2 py-1 text-sm font-medium text-blue-600 hover:text-blue-800 hover:bg-blue-50 rounded transition-colors",children:"Edit"})]}),f?(0,l.jsxs)("div",{className:"space-y-3",children:[(0,l.jsx)("input",{type:"text",placeholder:"Tracking Number",value:N.trackingNumber,onChange:e=>y((0,r.A)((0,r.A)({},N),{},{trackingNumber:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md"}),(0,l.jsx)("input",{type:"text",placeholder:"Carrier",value:N.carrier,onChange:e=>y((0,r.A)((0,r.A)({},N),{},{carrier:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md"}),(0,l.jsx)("input",{type:"date",value:N.estimatedDelivery,onChange:e=>y((0,r.A)((0,r.A)({},N),{},{estimatedDelivery:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md"}),(0,l.jsxs)("div",{className:"flex space-x-2",children:[(0,l.jsx)("button",{onClick:()=>(async e=>{try{await(0,a.A)("/orders/".concat(e,"/tracking"),"PUT",N),b(!1),y({trackingNumber:"",carrier:"",estimatedDelivery:""}),w()}catch(s){console.error("Error updating tracking:",s),alert("Error updating tracking information")}})(e._id),className:"px-3 py-1 bg-blue-600 text-white rounded text-sm",children:"Save"}),(0,l.jsx)("button",{onClick:()=>b(!1),className:"px-3 py-1 bg-gray-300 text-gray-700 rounded text-sm",children:"Cancel"})]})]}):(0,l.jsxs)("div",{className:"text-sm space-y-1",children:[(0,l.jsxs)("p",{children:[(0,l.jsx)("span",{className:"font-medium",children:"Tracking:"})," ",(null===(d=e.tracking)||void 0===d?void 0:d.trackingNumber)||"Not set"]}),(0,l.jsxs)("p",{children:[(0,l.jsx)("span",{className:"font-medium",children:"Carrier:"})," ",(null===(m=e.tracking)||void 0===m?void 0:m.carrier)||"Not set"]}),(0,l.jsxs)("p",{children:[(0,l.jsx)("span",{className:"font-medium",children:"Est. Delivery:"})," ",null!==(x=e.tracking)&&void 0!==x&&x.estimatedDelivery?D(e.tracking.estimatedDelivery):"Not set"]})]})]})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("h4",{className:"text-lg font-semibold mb-4",children:"Order Details"}),(0,l.jsxs)("div",{className:"bg-white p-4 rounded-lg mb-4",children:[(0,l.jsx)("h5",{className:"font-medium mb-2",children:"Shipping Address"}),(0,l.jsxs)("div",{className:"text-sm",children:[(0,l.jsx)("p",{className:"font-medium",children:e.shippingAddress.name}),(0,l.jsx)("p",{children:e.shippingAddress.street}),(0,l.jsxs)("p",{children:[e.shippingAddress.city,", ",e.shippingAddress.state," ",e.shippingAddress.zipCode]}),(0,l.jsx)("p",{children:e.shippingAddress.country}),(0,l.jsxs)("p",{className:"mt-1",children:["\ud83d\udcde ",e.shippingAddress.phone]})]})]}),(0,l.jsxs)("div",{className:"bg-white p-4 rounded-lg mb-4",children:[(0,l.jsx)("h5",{className:"font-medium mb-2",children:"Payment Information"}),(0,l.jsxs)("div",{className:"text-sm space-y-1",children:[(0,l.jsxs)("p",{children:[(0,l.jsx)("span",{className:"font-medium",children:"Method:"})," ",(null===(p=e.payment)||void 0===p||null===(g=p.method)||void 0===g?void 0:g.toUpperCase())||"Not set"]}),(0,l.jsxs)("p",{children:[(0,l.jsx)("span",{className:"font-medium",children:"Status:"})," ",(null===(j=e.payment)||void 0===j?void 0:j.status)||"Not set"]}),(null===(v=e.payment)||void 0===v?void 0:v.transactionId)&&(0,l.jsxs)("p",{children:[(0,l.jsx)("span",{className:"font-medium",children:"Transaction ID:"})," ",e.payment.transactionId]})]})]}),(0,l.jsxs)("div",{className:"bg-white p-4 rounded-lg",children:[(0,l.jsx)("h5",{className:"font-medium mb-2",children:"Order Summary"}),(0,l.jsxs)("div",{className:"text-sm space-y-1",children:[(0,l.jsxs)("div",{className:"flex justify-between",children:[(0,l.jsx)("span",{children:"Subtotal:"}),(0,l.jsxs)("span",{children:["\u20b9",e.subtotal]})]}),(0,l.jsxs)("div",{className:"flex justify-between",children:[(0,l.jsx)("span",{children:"Tax:"}),(0,l.jsxs)("span",{children:["\u20b9",e.tax]})]}),(0,l.jsxs)("div",{className:"flex justify-between",children:[(0,l.jsx)("span",{children:"Shipping:"}),(0,l.jsx)("span",{children:0===e.shippingCost?"Free":"\u20b9".concat(e.shippingCost)})]}),(0,l.jsxs)("div",{className:"border-t pt-1 flex justify-between font-semibold",children:[(0,l.jsx)("span",{children:"Total:"}),(0,l.jsxs)("span",{children:["\u20b9",e.totalAmount]})]})]})]})]})]})})]},e._id)})})]});var M}}}]);
//# sourceMappingURL=810.da7ee41d.chunk.js.map